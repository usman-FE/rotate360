<!DOCTYPE html>
<html
  lang="en"
  class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="./dist/main.css" />

    <link
      rel="icon"
      type="image/x-icon"
      href="/images/favicon.png" />

    <link
      rel="preconnect"
      href="https://fonts.googleapis.com" />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet" />

    <!-- <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script> -->
    <script
      defer
      src="https://unpkg.com/alpinejs@3.10.3/dist/cdn.min.js"></script>

    <title>mobWOW | Sell my car</title>
  </head>

  <body>
    <!-- MAIN CONTAINER START -->
    <main class="h-full">
      <!-- ROTATER SECTION START -->
      <section
        x-data="{
          imageCount: 72,
          imageSrcs: [],
          hotspots: [
            {
              hotspotText: 'This is the first hotspot',
              framesData: [
                {
                    currentImage: 'images/IMG_1.jpg',
                    top: 28.33283177851339,
                    left: 31.510416666666668
                },
                {
                    currentImage: 'images/IMG_72.jpg',
                    top: 28.814324405657537,
                    left: 32.20486111111111
                },
                {
                    currentImage: 'images/IMG_71.jpg',
                    top: 28.573578092085466,
                    left: 32.72569444444444
                },
                {
                    currentImage: 'images/IMG_70.jpg',
                    top: 28.573578092085466,
                    left: 33.76736111111111
                },
                {
                    currentImage: 'images/IMG_69.jpg',
                    top: 29.055070719229615,
                    left: 34.28819444444444
                },
                {
                    currentImage: 'images/IMG_68.jpg',
                    top: 28.814324405657537,
                    left: 35.67708333333333
                },
                {
                    currentImage: 'images/IMG_67.jpg',
                    top: 29.295817032801686,
                    left: 36.71875
                },
                {
                    currentImage: 'images/IMG_66.jpg',
                    top: 29.055070719229615,
                    left: 37.93402777777778
                },
                {
                    currentImage: 'images/IMG_65.jpg',
                    top: 29.055070719229615,
                    left: 39.67013888888889
                },
                {
                    currentImage: 'images/IMG_64.jpg',
                    top: 29.53656334637376,
                    left: 41.23263888888889
                },
                {
                    currentImage: 'images/IMG_63.jpg',
                    top: 29.055070719229615,
                    left: 42.79513888888889
                },
                {
                    currentImage: 'images/IMG_62.jpg',
                    top: 29.295817032801686,
                    left: 44.53125
                },
                {
                    currentImage: 'images/IMG_61.jpg',
                    top: 29.055070719229615,
                    left: 46.09375
                },
                {
                    currentImage: 'images/IMG_60.jpg',
                    top: 29.295817032801686,
                    left: 48.00347222222222
                },
                {
                    currentImage: 'images/IMG_59.jpg',
                    top: 29.295817032801686,
                    left: 49.56597222222222
                },
                {
                    currentImage: 'images/IMG_58.jpg',
                    top: 28.814324405657537,
                    left: 51.64930555555556
                },
                {
                    currentImage: 'images/IMG_57.jpg',
                    top: 29.53656334637376,
                    left: 53.732638888888886
                },
                {
                    currentImage: 'images/IMG_56.jpg',
                    top: 29.777309659945832,
                    left: 55.12152777777778
                },
                {
                    currentImage: 'images/IMG_55.jpg',
                    top: 29.53656334637376,
                    left: 56.68402777777778
                },
                {
                    currentImage: 'images/IMG_54.jpg',
                    top: 29.777309659945832,
                    left: 58.420138888888886
                },
                {
                    currentImage: 'images/IMG_53.jpg',
                    top: 28.814324405657537,
                    left: 59.635416666666664
                }
              ]
            },
            {
              hotspotText: 'This is the second hotspot',
              framesData: [
                {
                  currentImage: 'images/IMG_66.jpg',
                  top: 55.05567258501354,
                  left: 20.65972222222222,
                },
                {
                  currentImage: 'images/IMG_65.jpg',
                  top: 55.77791152572976,
                  left: 22.04861111111111,
                },
                {
                  currentImage: 'images/IMG_64.jpg',
                  top: 55.29641889858562,
                  left: 24.131944444444446,
                },
                {
                  currentImage: 'images/IMG_63.jpg',
                  top: 56.01865783930183,
                  left: 25.694444444444443,
                },
                {
                  currentImage: 'images/IMG_62.jpg',
                  top: 56.01865783930183,
                  left: 27.95138888888889,
                },
                {
                  currentImage: 'images/IMG_61.jpg',
                  top: 56.25940415287391,
                  left: 30.555555555555557,
                },
                {
                  currentImage: 'images/IMG_60.jpg',
                  top: 56.98164309359013,
                  left: 33.15972222222222,
                },
                {
                  currentImage: 'images/IMG_59.jpg',
                  top: 56.98164309359013,
                  left: 35.76388888888889,
                },
                {
                  currentImage: 'images/IMG_58.jpg',
                  top: 56.98164309359013,
                  left: 38.88888888888889,
                },
                {
                  currentImage: 'images/IMG_57.jpg',
                  top: 57.70388203430635,
                  left: 42.1875,
                },
                {
                  currentImage: 'images/IMG_56.jpg',
                  top: 56.98164309359013,
                  left: 45.13888888888889,
                },
                {
                  currentImage: 'images/IMG_55.jpg',
                  top: 57.46313572073428,
                  left: 48.4375,
                },
                {
                  currentImage: 'images/IMG_54.jpg',
                  top: 57.2223894071622,
                  left: 51.736111111111114,
                },
                {
                  currentImage: 'images/IMG_53.jpg',
                  top: 56.98164309359013,
                  left: 54.6875,
                },
                {
                  currentImage: 'images/IMG_52.jpg',
                  top: 57.46313572073428,
                  left: 57.986111111111114,
                },
                {
                  currentImage: 'images/IMG_51.jpg',
                  top: 56.740896780018055,
                  left: 60.9375,
                },
                {
                  currentImage: 'images/IMG_50.jpg',
                  top: 56.740896780018055,
                  left: 64.0625,
                },
                {
                  currentImage: 'images/IMG_49.jpg',
                  top: 56.740896780018055,
                  left: 66.84027777777779,
                },
                {
                  currentImage: 'images/IMG_48.jpg',
                  top: 56.01865783930183,
                  left: 69.09722222222221,
                },
                {
                  currentImage: 'images/IMG_47.jpg',
                  top: 55.77791152572976,
                  left: 71.875,
                },
                {
                  currentImage: 'images/IMG_46.jpg',
                  top: 55.05567258501354,
                  left: 73.95833333333334,
                },
                {
                  currentImage: 'images/IMG_45.jpg',
                  top: 55.53716521215769,
                  left: 75.86805555555556,
                },
                {
                  currentImage: 'images/IMG_44.jpg',
                  top: 54.5741799578694,
                  left: 77.60416666666666,
                },
                {
                  currentImage: 'images/IMG_43.jpg',
                  top: 54.5741799578694,
                  left: 78.81944444444444,
                },
                {
                  currentImage: 'images/IMG_42.jpg',
                  top: 54.092687330725255,
                  left: 80.38194444444444,
                },
              ],
            },
            {
              hotspotText: 'This is the third hotspot',
              framesData: [
                {
                  currentImage: 'images/IMG_50.jpg',
                  top: 54.5741799578694,
                  left: 49.30555555555556,
                },
                {
                  currentImage: 'images/IMG_49.jpg',
                  top: 54.5741799578694,
                  left: 52.25694444444444,
                },
                {
                  currentImage: 'images/IMG_48.jpg',
                  top: 55.77791152572976,
                  left: 55.38194444444444,
                },
                {
                  currentImage: 'images/IMG_47.jpg',
                  top: 55.77791152572976,
                  left: 57.986111111111114,
                },
                {
                  currentImage: 'images/IMG_46.jpg',
                  top: 55.53716521215769,
                  left: 60.59027777777778,
                },
                {
                  currentImage: 'images/IMG_45.jpg',
                  top: 55.53716521215769,
                  left: 62.84722222222222,
                },
                {
                  currentImage: 'images/IMG_44.jpg',
                  top: 54.814926271441465,
                  left: 65.10416666666666,
                },
                {
                  currentImage: 'images/IMG_43.jpg',
                  top: 54.5741799578694,
                  left: 66.66666666666666,
                },
                {
                  currentImage: 'images/IMG_42.jpg',
                  top: 54.33343364429732,
                  left: 68.57638888888889,
                },
                {
                  currentImage: 'images/IMG_41.jpg',
                  top: 53.85194101715317,
                  left: 69.79166666666666,
                },
                {
                  currentImage: 'images/IMG_40.jpg',
                  top: 53.6111947035811,
                  left: 71.52777777777779,
                },
                {
                  currentImage: 'images/IMG_39.jpg',
                  top: 53.37044839000903,
                  left: 72.74305555555556,
                },
                {
                  currentImage: 'images/IMG_38.jpg',
                  top: 53.129702076436956,
                  left: 73.95833333333334,
                },
                {
                  currentImage: 'images/IMG_37.jpg',
                  top: 52.40746313572073,
                  left: 74.82638888888889,
                },
                {
                  currentImage: 'images/IMG_36.jpg',
                  top: 52.166716822148665,
                  left: 75.52083333333334,
                },
                {
                  currentImage: 'images/IMG_35.jpg',
                  top: 51.92597050857659,
                  left: 76.5625,
                },
                {
                  currentImage: 'images/IMG_34.jpg',
                  top: 51.92597050857659,
                  left: 76.90972222222221,
                },
                {
                  currentImage: 'images/IMG_33.jpg',
                  top: 51.92597050857659,
                  left: 77.25694444444444,
                },
                {
                  currentImage: 'images/IMG_32.jpg',
                  top: 51.203731567860366,
                  left: 76.90972222222221,
                },
                {
                  currentImage: 'images/IMG_31.jpg',
                  top: 50.722238940716224,
                  left: 76.73611111111111,
                },
                {
                  currentImage: 'images/IMG_30.jpg',
                  top: 50.240746313572075,
                  left: 75.86805555555556,
                },
                {
                  currentImage: 'images/IMG_29.jpg',
                  top: 50.48149262714414,
                  left: 75.86805555555556,
                },
                {
                  currentImage: 'images/IMG_28.jpg',
                  top: 49.759253686427925,
                  left: 74.65277777777779,
                },
                {
                  currentImage: 'images/IMG_27.jpg',
                  top: 50,
                  left: 73.95833333333334,
                },
                {
                  currentImage: 'images/IMG_26.jpg',
                  top: 49.27776105928378,
                  left: 72.74305555555556,
                },
                {
                  currentImage: 'images/IMG_25.jpg',
                  top: 49.27776105928378,
                  left: 71.18055555555556,
                },
              ],
            },
            {
              hotspotText: 'This is the forth hotspot',
              framesData: [
                {
                  currentImage: 'images/IMG_27.jpg',
                  top: 47.59253686427927,
                  left: 41.66666666666667,
                },
                {
                  currentImage: 'images/IMG_26.jpg',
                  top: 48.07402949142342,
                  left: 42.01388888888889,
                },
                {
                  currentImage: 'images/IMG_25.jpg',
                  top: 47.833283177851335,
                  left: 43.05555555555556,
                },
                {
                  currentImage: 'images/IMG_24.jpg',
                  top: 47.59253686427927,
                  left: 43.75,
                },
                {
                  currentImage: 'images/IMG_23.jpg',
                  top: 48.07402949142342,
                  left: 44.27083333333333,
                },
                {
                  currentImage: 'images/IMG_22.jpg',
                  top: 48.55552211856756,
                  left: 45.3125,
                },
                {
                  currentImage: 'images/IMG_21.jpg',
                  top: 48.314775804995485,
                  left: 46.00694444444444,
                },
                {
                  currentImage: 'images/IMG_20.jpg',
                  top: 48.55552211856756,
                  left: 46.52777777777778,
                },
                {
                  currentImage: 'images/IMG_19.jpg',
                  top: 48.314775804995485,
                  left: 47.74305555555556,
                },
                {
                  currentImage: 'images/IMG_18.jpg',
                  top: 48.55552211856756,
                  left: 48.61111111111111,
                },
                {
                  currentImage: 'images/IMG_17.jpg',
                  top: 48.55552211856756,
                  left: 49.82638888888889,
                },
                {
                  currentImage: 'images/IMG_16.jpg',
                  top: 48.55552211856756,
                  left: 50.69444444444444,
                },
                {
                  currentImage: 'images/IMG_15.jpg',
                  top: 48.07402949142342,
                  left: 52.083333333333336,
                },
                {
                  currentImage: 'images/IMG_14.jpg',
                  top: 48.314775804995485,
                  left: 52.77777777777778,
                },
                {
                  currentImage: 'images/IMG_13.jpg',
                  top: 48.314775804995485,
                  left: 53.125,
                },
                {
                  currentImage: 'images/IMG_12.jpg',
                  top: 48.55552211856756,
                  left: 55.03472222222222,
                },
                {
                  currentImage: 'images/IMG_11.jpg',
                  top: 48.07402949142342,
                  left: 55.38194444444444,
                },
                {
                  currentImage: 'images/IMG_10.jpg',
                  top: 47.833283177851335,
                  left: 56.076388888888886,
                },
                {
                  currentImage: 'images/IMG_9.jpg',
                  top: 47.35179055070719,
                  left: 57.11805555555556,
                },
              ],
            }
    
          ],
          currentImageIndex: 0,
          enableMarkers: false,
          isLoaded: false,
          loadedImage: 0,
          isRotating: false,
          startX: 0,
          startY: 0,
          firstClickHappend: false,
          initialTop: null,
          initialHotspotText: '',
          framesData: [],
          imageLoader(){

            for (let i = 1; i <= this.imageCount; i++) {

              const pathName = `images/IMG_${i}.jpg`;
              this.imageSrcs.push(pathName);

              const image = new Image();
              image.src = pathName;

              image.onload = () => {
                this.checkAllImageLoaded();
              }
            }
          },
          checkAllImageLoaded(){
            this.loadedImage++;
            if(this.loadedImage === this.imageSrcs.length) this.isLoaded = true;
          },
          getCoordinates(e, el){

            const rect = el.getBoundingClientRect();
            const mouseX = e.clientX || e.touches[0].clientX;
            const mouseY = e.clientY || e.touches[0].clientY;

            const pointX = (mouseX - rect.left) / rect.width;
            const pointY =  (mouseY - rect.top) / rect.height;

            return [pointX, pointY]
          },
          setInitialCoords(e, el){
            const [x, y] = this.getCoordinates(e, el);
            this.startX = x;
            this.startY = y;
          },
          rotateImage(e, el){
            const [currentX, currentY] = this.getCoordinates(e, el);

            if
              (currentX < this.startX) {
              this.currentImageIndex++;
              if(this.currentImageIndex === this.imageSrcs.length) this.currentImageIndex = 0;
            } 
            if
              (currentX > this.startX) {
              this.currentImageIndex--;
              if(this.currentImageIndex < 0) this.currentImageIndex = this.imageSrcs.length - 1;
            } 

            this.startX = currentX;
            this.startY = currentY;
          },
          getConstantDataOfHotspot(e, el){

            if(this.firstClickHappend) return;
            const hotspotText = 'This is first hotspot'
            this.initialHotspotText = hotspotText;

          },
          getFrameDataOnClick(e, el){
            const rect = el.getBoundingClientRect();
            const scaleX = el.offsetWidth / rect.width;
            const scaleY = el.offsetHeight / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            const currentImage = this.imageSrcs[this.currentImageIndex];

            this.framesData.push({
              currentImage,
              top: y / el.offsetHeight * 100,
              left: x / el.offsetWidth * 100,
            });
          },
          setHotspotData(){

            if(!this.enableMarkers) return;

            this.hotspots.push({
              hotspotText: this.initialHotspotText,
              framesData: this.framesData,
            });

            this.firstClickHappend = false;
            this.initialHotspotText = '';
            this.initialTop = null;
            this.framesData = [];

            console.log(this.hotspots);
          }
        }">
        <div
          class="container mx-auto px-[15px] xl:max-w-[1200px] font-['Roboto'] my-20">
          <!-- SLIDER CONTAINER -->
          <div
            :class="isRotating ? 'cursor-grabbing' : 'cursor-grab'"
            class="flex items-center justify-center w-full max-h-[24rem] select-none relative"
            @click="
              if(!enableMarkers) return;
              getConstantDataOfHotspot($event, $refs.image);
              firstClickHappend = true;
              getFrameDataOnClick($event, $refs.image);
            "
            @mousedown="
              isRotating = true;
              setInitialCoords($event, $el);
            "
            @touchstart="
              isRotating = true;
              setInitialCoords($event, $el);
            "
            @mousemove="

              if(!isRotating) return;
              rotateImage($event, $el);
            "
            @touchmove="

              if(!isRotating) return;
              rotateImage($event, $el);
            "
            @touchmove.outside="
              isRotating = false;
            "
            @mouseup="
              isRotating = false;
            "
            @touchend="
              isRotating = false;
            "
            @mouseleave="
              isRotating = false;
            ">
            <!-- LOADER IMAGE -->
            <img
              class="w-full h-auto max-w-md"
              x-show="!isLoaded"
              src="images/loading.gif"
              alt="Loading Image" />
            <!-- ACTUAL IMAGE -->
            <div class="relative">
              <img
                draggable="false"
                class="w-full h-auto max-w-xl transition-all"
                x-show="isLoaded"
                x-ref="image"
                :src="imageSrcs[currentImageIndex]"
                @load.window="imageLoader"
                alt="" />
              <!-- MARKERS -->
              <template
                x-for="(hotspot, index) in hotspots"
                :key="index">
                <template
                  x-for="(frameData, index) in hotspot.framesData"
                  :key="index">
                  <div
                    x-show="(frameData.currentImage == imageSrcs[currentImageIndex]) && isLoaded"
                    :style="'left:' + frameData.left + '%;' + 'top:' + frameData.top + '%;'"
                    class="w-4 h-4 rounded-full -translate-x-1/2 -translate-y-1/2 absolute transition-all">
                    <img
                      src="images/favicon.png"
                      alt="Favicon"
                      class="w-full h-auto" />
                  </div>
                </template>
              </template>
            </div>
          </div>
          <!-- CONTROLS -->
          <div
            class="flex gap-4 fixed w-full left-0 bottom-6 justify-center">
            <button
              class="p-1 border border-red-600 text-xs"
              @click.prevent="
              currentImageIndex++;
              if(currentImageIndex === imageSrcs.length) currentImageIndex = 0;
            ">
              Prev frame
            </button>
            <button
              class="p-1 border border-red-600 text-xs"
              @click.prevent="
            currentImageIndex--;
              if(currentImageIndex < 0) currentImageIndex = imageSrcs.length - 1;
            ">
              Next frame
            </button>
            <button
              class="bg-red-600 text-white p-1 text-xs"
              @click.prevent="
              setHotspotData();
              enableMarkers = !enableMarkers"
              x-text="!enableMarkers ? 'Start putting markers frame by frame' : 'Save markers'"></button>
          </div>
        </div>
      </section>
      <!-- ROTATER SECTION END -->
    </main>
    <!-- MAIN CONTAINER END -->
  </body>
</html>
