<!DOCTYPE html>
<html
  lang="en"
  class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="./dist/main.css" />

    <link
      rel="icon"
      type="image/x-icon"
      href="/images/favicon.png" />

    <link
      rel="preconnect"
      href="https://fonts.googleapis.com" />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet" />

    <!-- <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script> -->
    <script
      defer
      src="https://unpkg.com/alpinejs@3.10.3/dist/cdn.min.js"></script>

    <title>mobWOW | Sell my car</title>
  </head>

  <body>
    <!-- MAIN CONTAINER START -->
    <main class="h-full">
      <!-- ROTATER SECTION START -->
      <section
        x-data="{
          imageCount: 72,
          imageSrcs: [],
          hotspots: [
              {
                  left: 33.55654648372105,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_70.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 34.449403626578196,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_69.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 35.342260769435335,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_68.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 36.68154648372105,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_67.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 37.79761791229248,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_66.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 39.36011791229248,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_65.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 41.145832198006765,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_64.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 42.48511791229248,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_63.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 44.270832198006765,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_62.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 45.833332198006765,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_61.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 47.842260769435335,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_60.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 49.627975055149626,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_59.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 51.41368934086391,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_58.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 53.19940362657819,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_57.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 54.98511791229248,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_56.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 56.77083219800677,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_55.jpg',
                  hotspotText: 'This is hotspot 1'
              },
              {
                  left: 58.33333219800677,
                  top: 28.682893370150193,
                  currentImage: 'images/IMG_54.jpg',
                  hotspotText: 'This is hotspot 1'
              }
          ],
          currentImageIndex: 0,
          enableMarkers: false,
          isLoaded: false,
          loadedImage: 0,
          isRotating: false,
          startX: 0,
          startY: 0,
          imageLoader(){

            for (let i = 1; i <= this.imageCount; i++) {

              const pathName = `images/IMG_${i}.jpg`;
              this.imageSrcs.push(pathName);

              const image = new Image();
              image.src = pathName;

              image.onload = () => {
                this.checkAllImageLoaded();
              }
            }
          },
          checkAllImageLoaded(){
            this.loadedImage++;
            if(this.loadedImage === this.imageSrcs.length) this.isLoaded = true;
          },
          getCoordinates(e, el){

            const rect = el.getBoundingClientRect();
            const mouseX = e.clientX || e.touches[0].clientX;
            const mouseY = e.clientY || e.touches[0].clientY;

            const pointX = (mouseX - rect.left) / rect.width;
            const pointY =  (mouseY - rect.top) / rect.height;

            return [pointX, pointY]
          },
          setInitialCoords(e, el){
            const [x, y] = this.getCoordinates(e, el);
            this.startX = x;
            this.startY = y;
          },
          rotateImage(e, el){
            const [currentX, currentY] = this.getCoordinates(e, el);

            if
              (currentX < this.startX) {
              this.currentImageIndex++;
              if(this.currentImageIndex === this.imageSrcs.length) this.currentImageIndex = 0;
            } 
            if
              (currentX > this.startX) {
              this.currentImageIndex--;
              if(this.currentImageIndex < 0) this.currentImageIndex = this.imageSrcs.length - 1;
            } 

            this.startX = currentX;
            this.startY = currentY;
          },
          getDataOnClick(e, el){
            const rect = el.getBoundingClientRect();
            const scaleX = el.offsetWidth / rect.width;
            const scaleY = el.offsetHeight / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            const currentImage = this.imageSrcs[this.currentImageIndex];
            const hotspotText = 'This is hotspot 1';
            
            this.hotspots.push({
              left: x / el.offsetWidth * 100,
              top: y / el.offsetHeight * 100,
              currentImage,
              hotspotText
            });

            console.log(this.hotspots);
          }
        }">
        <div
          class="container mx-auto px-[15px] xl:max-w-[1200px] font-['Roboto'] my-20">
          <!-- SLIDER CONTAINER -->
          <div
            :class="isRotating ? 'cursor-grabbing' : 'cursor-grab'"
            class="flex items-center justify-center w-full max-h-[24rem] select-none relative"
            @click="
              if(!enableMarkers) return;
              getDataOnClick($event, $refs.image);
            "
            @mousedown="
              isRotating = true;
              setInitialCoords($event, $el);
            "
            @touchstart="
              isRotating = true;
              setInitialCoords($event, $el);
            "
            @mousemove="

              if(!isRotating) return;
              rotateImage($event, $el);
            "
            @touchmove="

              if(!isRotating) return;
              rotateImage($event, $el);
            "
            @touchmove.outside="
              isRotating = false;
            "
            @mouseup="
              isRotating = false;
            "
            @touchend="
              isRotating = false;
            "
            @mouseleave="
              isRotating = false;
            ">
            <!-- LOADER IMAGE -->
            <img
              class="w-full h-auto max-w-md"
              x-show="!isLoaded"
              src="images/loading.gif"
              alt="Loading Image" />
            <!-- ACTUAL IMAGE -->
            <div class="relative">
              <img
                draggable="false"
                class="w-full h-auto max-w-md transition-all"
                x-show="isLoaded"
                x-ref="image"
                :src="imageSrcs[currentImageIndex]"
                @load.window="imageLoader"
                alt="" />
              <!-- MARKERS -->
              <template
                x-for="(hotspot, index) in hotspots"
                :key="index">
                <div
                  x-show="hotspot.currentImage == imageSrcs[currentImageIndex]"
                  :style="'left:' + hotspot.left + '%;' + 'top:' + hotspot.top + '%;'"
                  class="w-4 h-4 rounded-full -translate-x-1/2 -translate-y-1/2 absolute bg-red-600 transition-all"></div>
              </template>
            </div>
          </div>
          <!-- CONTROLS -->
          <div class="flex gap-4">
            <button
              @click.prevent="
              currentImageIndex++;
              if(currentImageIndex === imageSrcs.length) currentImageIndex = 0;
              console.log(imageSrcs[currentImageIndex]);
            ">
              Left
            </button>
            <button
              @click.prevent="
            currentImageIndex--;
              if(currentImageIndex < 0) currentImageIndex = imageSrcs.length - 1;
              console.log(imageSrcs[currentImageIndex]);
            ">
              Right
            </button>
            <button
              class="bg-red-600 text-white p-1 text-xs"
              @click.prevent="
              enableMarkers = !enableMarkers
            ">
              Enable Markers
            </button>
          </div>
        </div>
      </section>
      <!-- ROTATER SECTION END -->
    </main>
    <!-- MAIN CONTAINER END -->
  </body>
</html>
